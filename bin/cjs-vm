#!/usr/bin/env node
"use strict";
const program = require('commander');
const lex = require('../src/lexico/scanner');
const parser = require('../src/sintactico/parser');
//const { parser } = require('stream-json');
const db = require('../src/vm/debug');
const Bytecode = require('../src/vm/bytecode');
const VM = require('../src/vm/vm');
const OP = require('../src/vm/opCodes');


program
	.command('lex')
	.description('run setup commands for all envs')
	.option("-u, --ui", "para usar desde ide, lee el programa de stdio")
	.option("-f, --file <path>", "para leer el archivo <path>")
	.action(function (options) {
		if (options.ui) {
			lex.fromStream(process.stdin, continuar);

		} else if (options.file) {
			process.stdout.write(lex.fromFile(options.file).map((token) => {
				return `\n${token.value}`;
			}).toString());
		} else {

		}
	});

program
	.command('parse <path>')
	.alias('ex')
	.description('execute the given remote cmd')
	.option("-e, --exec_mode <mode>", "Which exec mode to use")
	.action(function (path, options) {
		console.log('parseando...')
		let vm = new VM();

		let bytecode = parser.parse(lex.fromFile(path));
		db.dissasemble(bytecode, 'prueba');
		vm.interpret(bytecode);
	}).on('--help', function () {
		console.log('');
		console.log('Examples:');
	});


program
	.command('test')
	.alias('ex')
	.description('execute the given remote cmd')
	.option("-e, --exec_mode <mode>", "Which exec mode to use")
	.action(function (path, options) {
		console.log('probando...');
		let vm = new VM();

		let chunk = new Bytecode();

		db.dissasemble(chunk, 'prueba');

		//console.log('corriendo...');
		//vm.interpret(chunk);
	}).on('--help', function () {
	});





program.parse(process.argv);