#!/usr/bin/env node
"use strict";
const program = require('commander');
const lex = require('../src/lexico/scanner');
const parser = require('../src/sintactico/parser');
//const { parser } = require('stream-json');
const db = require('../src/vm/debug');
const Bytecode = require('../src/vm/bytecode');
const VM = require('../src/vm/vm');
const jetpack = require('fs-jetpack');


program
	.command('lex')
	.description('run setup commands for all envs')
	.option("-u, --ui", "para usar desde ide, lee el programa de stdio")
	.option("-f, --file <path>", "para leer el archivo <path>")
	.action(function (options) {
		if (options.ui) {
			lex.fromStream(process.stdin, continuar);

		} else if (options.file) {
			process.stdout.write(lex.fromFile(options.file).map((token) => {
				return `\n${token.value}`;
			}).toString());
		} else {

		}
	});

program
	.command('parse')
	.description('execute the given remote cmd')
	.option("-u, --ui", "para usar desde ide, lee el programa de stdio")
	.option("-f, --file <path>", "para leer el archivo <path>")
	.action(function (path, options) {
		console.log('parseando...')
		let vm = new VM();

		let bytecode = parser.parse(lex.fromFile(path));
		db.dissasemble(bytecode, 'prueba');
		bytecode.save();
		vm.interpret(bytecode);
	}).on('--help', function () {
		console.log('');
		console.log('Examples:');
	});


program
	.command('run <path>')
	.description('execute the given remote cmd')
	.option("-d, --debug", "Which exec mode to use")
	.option("-u, --ui", "para usar desde ide, lee el programa de stdio")
	.option("-f, --file <path>", "para leer el archivo <path>")
	.action(function (path, options) {
		console.log('probando...');
		let vm = new VM();

		bytecode.load('codigo.cj');
		db.dissasemble(bytecode, 'loaded');
		vm.interpret(bytecode);
	}).on('--help', function () {
	});



function ejecutar(tokenlist){
	
}

program.parse(process.argv);